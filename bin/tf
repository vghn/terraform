#!/usr/bin/env bash
# Terraform CLI

# Load environment
# shellcheck disable=1090
. "$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd -P)/envrc"

# Usage
usage(){
  echo '---------------------------------------------'
  echo "USAGE: ${BASH_SOURCE[0]} [COMMAND] [OPTIONS]"
  echo '---------------------------------------------'
  echo '----------------------------------------------'
  echo 'For more information please consult the README'
  echo '----------------------------------------------'
  exit 1
}

# Process Stack CLI
tf_process_cli(){
  trap 'bye $?' EXIT HUP INT QUIT TERM

  local cmd var
  cmd="${1:-}"
  var="-var 'version=${VERSION}'"

  case "$cmd" in
    apply|import|plan|push|refresh|validate)
      eval terraform "${@:-}" "$var"
      ;;
    *)
      eval terraform "${@:-}"
      ;;
  esac
}

tf_process_cli "${@:-}"
